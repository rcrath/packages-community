# Maintainer: Stefano Capitani <stefano@manjaro.org>
# Autor: The Panacea Project

pkgname=gnome-shell-extension-gnomenu
_pkgname=gno-menu
pkgver=23
pkgrel=2
_git=no
pkgdesc="GnoMenu is a traditional styled full featured Gnome-Shell apps-menu, that aims to offer all the essentials in a simple uncluttered intuitive interface."
arch=(any)
url="https://github.com/The-Panacea-Projects/Gnomenu"
license=(GPL3)
depends=('gnome-shell' 'gnome-tweak-tool' 'gnome-menus')
makedepends=(git)
md5sums=('ad998dabeb658436a060db61c07852ce'
         'e3e8538d7c57eb723fb92388f0f4a5f1'
         'a0a3b183601fc93138bd9107170cd758')

if [ "$_git" == "yes" ]; then
_snapshot=$(git log --pretty=format:'%h' -n 1)
   source=("$_pkgname.v$pkgver::git+$url"
	   "manjaro.patch"
           "gnome-328-compat.patch")

prepare() {

# Override the shortcut to call gnomenu (default is F2 now <Shift>F3)

  cd ${_pkgname}.v${pkgver}/schemas
  patch -N -i ${srcdir}/manjaro.patch
  cd ..
  patch -Np1 -i ${srcdir}/gnome-328-compat.patch
}

package(){
        install -dm755 $srcdir/$_pkgname.v$pkgver $pkgdir/usr/share/gnome-shell/extensions/
	cp -r $srcdir/$_pkgname.v$pkgver $pkgdir/usr/share/gnome-shell/extensions/
	mv $pkgdir/usr/share/gnome-shell/extensions/$_pkgname.v$pkgver $pkgdir/usr/share/gnome-shell/extensions/gnomenu@panacier.gmail.com
	cd $pkgdir/usr/share/gnome-shell/extensions/gnomenu@panacier.gmail.com/
        rm -rf .git* Screenshot.png README.md
    cd $pkgdir/usr/share/gnome-shell/extensions/gnomenu@panacier.gmail.com/icons
        ln -s /usr/share/icons/manjaro/maia/maia.svg
#Remove the precompiled gschemas because with this i can't override the men첫 ( hide apps men첫 by default )
	rm -f $pkgdir/usr/share/gnome-shell/extensions/gnomenu@panacier.gmail.com/schemas/gschemas.compiled
        glib-compile-schemas $pkgdir/usr/share/gnome-shell/extensions/gnomenu@panacier.gmail.com/schemas/
}

else

   source=("https://github.com/The-Panacea-Projects/Gnomenu/archive/$_pkgname.v$pkgver.tar.gz"
	   "manjaro.patch"
           "gnome-328-compat.patch")

prepare() {

# Override the shortcut to call gnomenu: default is F2 now <Shift>F3

  cd Gnomenu-${_pkgname}.v${pkgver}/schemas
  patch -N -i ${srcdir}/manjaro.patch
  cd ..
  patch -Np1 -i ${srcdir}/gnome-328-compat.patch
}



   package(){
        install -dm755 $srcdir/Gnomenu-$_pkgname.v$pkgver $pkgdir/usr/share/gnome-shell/extensions/
	cp -r $srcdir/Gnomenu-$_pkgname.v$pkgver $pkgdir/usr/share/gnome-shell/extensions/
	mv $pkgdir/usr/share/gnome-shell/extensions/Gnomenu-$_pkgname.v$pkgver $pkgdir/usr/share/gnome-shell/extensions/gnomenu@panacier.gmail.com
	cd $pkgdir/usr/share/gnome-shell/extensions/gnomenu@panacier.gmail.com/
        rm -rf .git* Screenshot.png README.md
    cd $pkgdir/usr/share/gnome-shell/extensions/gnomenu@panacier.gmail.com/icons
        ln -s /usr/share/icons/manjaro/maia/maia.svg     
#Remove the precompiled gschemas because with this i can't override the men첫 ( hide apps men첫 by default )
	rm -f $pkgdir/usr/share/gnome-shell/extensions/gnomenu@panacier.gmail.com/schemas/gschemas.compiled
        glib-compile-schemas $pkgdir/usr/share/gnome-shell/extensions/gnomenu@panacier.gmail.com/schemas/
}
fi

