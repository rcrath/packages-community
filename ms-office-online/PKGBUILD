# Maintainer: Philip MÃ¼ller <philm@manjaro.org>

pkgname=('ms-office-online')
pkgver=18.04.0
pkgrel=1
pkgdesc="Microsoft Office Suite Online for Manjaro Linux"
url="https://www.office.com/"
depends=('python-jade-application-kit>=0.a35')
license=('custom')
arch=('any')
provides=('microsoft-office-online' 'microsoft-office')
source=('ms-office-online'
        'Office.png'
        'PowerPoint.png'
        'Excel.png'
        'Word.png'
        'Outlook.png'
        'OneNote.png'
        'Skype.png'
        'MSOffice.desktop'
        'PowerPoint.desktop'
        'Excel.desktop'
        'Word.desktop'
        'Outlook.desktop'
        'OneNote.desktop'
        'settings.json'
        'WebSkype.desktop')
sha256sums=('675608ff3510a5b3ae840fe0b680c77a1ef7cecdb33ba6e2c914d844f02d7bba'
            '4b56e30b503bf76dd2887677d0ddf892d928655b968ce484253c879525805e3b'
            'ef09c317a685559698a8da72bd455f55a4db7e8a62b3fe0a18caedf5ceba9b83'
            'f2134e5c8cfd26e0a014d12467d4cb0ee3575f37ffa4ae3fc2422e8ba3093258'
            '2404ed5e60101f71d287c7f91fc39e4c2e0845af8fea9ad2685a62e7bd4240db'
            '62903d36d3a13b6504c3ca1e321b556c3eb4940c54ecad76963efdc6239876cc'
            '60d08c7012ec328e18d24ab1a5bc64370ba8f4b3d13ec9042b0af5f3ac75e29f'
            'c0b6032b30191f22ab8cd461e697d93c5008a485f33401c4e9b74d3984a29ecb'
            '1ca746fbffffd27197a3cc706549ec70def84d6841fd85886373f9d990572b4f'
            '9d06d13dcb717505b6dad8f8a571d46ca5ff77b7df54d8d3801ecc5d03097d94'
            '5eb8fa731876811fa57079f7a7a28ee7b803b1b95cc836637361be5728c8b1a6'
            '5ae79390d43e82273c5acd76b65bcc610ac37420faae4ce9c8e74d71e1e08355'
            '439143c1fa418a2aa460bb2b181b575975dc2eda0acacfd6601bd427a4d0e7fa'
            '11c7701466a62cb5369e686a2ba37f63d4c92d073562c26656a4f35046648e29'
            '22ff1d1cb0c8f614082e56857d55ebcdd4392498464ce9e7bf717ebb42a177ac'
            '14c8daf3b9e3deb38e56b0cf029466299f1bd9f32082b678358349d7912d0a65')
package() {
    # Install ms-office-online launcher
    install -Dm755 "${srcdir}"/ms-office-online "${pkgdir}"/usr/share/ms-office/msoffice/ms-office-online
    install -Dm755 "${srcdir}"/ms-office-online "${pkgdir}"/usr/share/ms-office/powerpoint/ms-office-online
    install -Dm755 "${srcdir}"/ms-office-online "${pkgdir}"/usr/share/ms-office/excel/ms-office-online
    install -Dm755 "${srcdir}"/ms-office-online "${pkgdir}"/usr/share/ms-office/word/ms-office-online
    install -Dm755 "${srcdir}"/ms-office-online "${pkgdir}"/usr/share/ms-office/outlook/ms-office-online
    install -Dm755 "${srcdir}"/ms-office-online "${pkgdir}"/usr/share/ms-office/onenote/ms-office-online
    install -Dm755 "${srcdir}"/ms-office-online "${pkgdir}"/usr/share/ms-office/webskype/ms-office-online
    
    # Install json settings
    install -Dm644 "${srcdir}"/settings.json "${pkgdir}"/usr/share/ms-office/msoffice/settings.json
    install -Dm644 "${srcdir}"/settings.json "${pkgdir}"/usr/share/ms-office/powerpoint/settings.json
    install -Dm644 "${srcdir}"/settings.json "${pkgdir}"/usr/share/ms-office/excel/settings.json
    install -Dm644 "${srcdir}"/settings.json "${pkgdir}"/usr/share/ms-office/word/settings.json
    install -Dm644 "${srcdir}"/settings.json "${pkgdir}"/usr/share/ms-office/outlook/settings.json
    install -Dm644 "${srcdir}"/settings.json "${pkgdir}"/usr/share/ms-office/onenote/settings.json
    install -Dm644 "${srcdir}"/settings.json "${pkgdir}"/usr/share/ms-office/webskype/settings.json
    
    # Create binaries
    mkdir -p "${pkgdir}"/usr/bin

    echo "#!/bin/sh" > "${pkgdir}"/usr/bin/msoffice
    echo "cd /usr/share/ms-office/msoffice" >> "${pkgdir}"/usr/bin/msoffice
    echo "./ms-office-online" >> "${pkgdir}"/usr/bin/msoffice
    sed -i -e "s|_URL_|https://www.office.com/login?es=Click&ru=%2F|" "${pkgdir}"/usr/share/ms-office/msoffice/settings.json

    echo "#!/bin/sh" > "${pkgdir}"/usr/bin/powerpoint
    echo "cd /usr/share/ms-office/powerpoint" >> "${pkgdir}"/usr/bin/powerpoint
    echo "./ms-office-online" >> "${pkgdir}"/usr/bin/powerpoint
    sed -i -e "s|_URL_|https://office.live.com/start/PowerPoint.aspx|" "${pkgdir}"/usr/share/ms-office/powerpoint/settings.json

    echo "#!/bin/sh" > "${pkgdir}"/usr/bin/excel
    echo "cd /usr/share/ms-office/excel" >> "${pkgdir}"/usr/bin/excel
    echo "./ms-office-online" >> "${pkgdir}"/usr/bin/excel
    sed -i -e "s|_URL_|https://office.live.com/start/Excel.aspx|" "${pkgdir}"/usr/share/ms-office/excel/settings.json

    echo "#!/bin/sh" > "${pkgdir}"/usr/bin/word
    echo "cd /usr/share/ms-office/word" >> "${pkgdir}"/usr/bin/word
    echo "./ms-office-online" >> "${pkgdir}"/usr/bin/word
    sed -i -e "s|_URL_|https://office.live.com/start/Word.aspx|" "${pkgdir}"/usr/share/ms-office/word/settings.json

    echo "#!/bin/sh" > "${pkgdir}"/usr/bin/outlook
    echo "cd /usr/share/ms-office/outlook" >> "${pkgdir}"/usr/bin/outlook
    echo "./ms-office-online" >> "${pkgdir}"/usr/bin/outlook
    sed -i -e "s|_URL_|https://outlook.live.com/owa|" "${pkgdir}"/usr/share/ms-office/outlook/settings.json

    echo "#!/bin/sh" > "${pkgdir}"/usr/bin/onenote
    echo "cd /usr/share/ms-office/onenote" >> "${pkgdir}"/usr/bin/onenote
    echo "./ms-office-online" >> "${pkgdir}"/usr/bin/onenote
    sed -i -e "s|_URL_|https://www.onenote.com/notebooks|" "${pkgdir}"/usr/share/ms-office/onenote/settings.json

    echo "#!/bin/sh" > "${pkgdir}"/usr/bin/webskype
    echo "cd /usr/share/ms-office/webskype" >> "${pkgdir}"/usr/bin/webskype
    echo "./ms-office-online" >> "${pkgdir}"/usr/bin/webskype
    sed -i -e "s|_URL_|https://web.skype.com|" "${pkgdir}"/usr/share/ms-office/webskype/settings.json

    chmod a+x "${pkgdir}"/usr/bin/*

    # Configure json settings
    sed -i -e "s|_icon_|/usr/share/icons/ms-office/Office.png|" "${pkgdir}"/usr/share/ms-office/msoffice/settings.json
    sed -i -e "s|_icon_|/usr/share/icons/ms-office/PowerPoint.png|" "${pkgdir}"/usr/share/ms-office/powerpoint/settings.json
    sed -i -e "s|_icon_|/usr/share/icons/ms-office/Excel.png|" "${pkgdir}"/usr/share/ms-office/excel/settings.json
    sed -i -e "s|_icon_|/usr/share/icons/ms-office/Word.png|" "${pkgdir}"/usr/share/ms-office/word/settings.json
    sed -i -e "s|_icon_|/usr/share/icons/ms-office/Outlook.png|" "${pkgdir}"/usr/share/ms-office/outlook/settings.json
    sed -i -e "s|_icon_|/usr/share/icons/ms-office/OneNote.png|" "${pkgdir}"/usr/share/ms-office/onenote/settings.json
    sed -i -e "s|_icon_|/usr/share/icons/ms-office/Skype.png|" "${pkgdir}"/usr/share/ms-office/webskype/settings.json

    # Install icons
    install -Dm644 "${srcdir}"/Office.png "${pkgdir}"/usr/share/icons/ms-office/Office.png
    install -Dm644 "${srcdir}"/PowerPoint.png "${pkgdir}"/usr/share/icons/ms-office/PowerPoint.png
    install -Dm644 "${srcdir}"/Excel.png "${pkgdir}"/usr/share/icons/ms-office/Excel.png
    install -Dm644 "${srcdir}"/Word.png "${pkgdir}"/usr/share/icons/ms-office/Word.png
    install -Dm644 "${srcdir}"/Outlook.png "${pkgdir}"/usr/share/icons/ms-office/Outlook.png
    install -Dm644 "${srcdir}"/OneNote.png "${pkgdir}"/usr/share/icons/ms-office/OneNote.png
    install -Dm644 "${srcdir}"/Skype.png "${pkgdir}"/usr/share/icons/ms-office/Skype.png

    # Install desktop files
    install -Dm644 "${srcdir}"/MSOffice.desktop "${pkgdir}"/usr/share/applications/MSOffice.desktop
    install -Dm644 "${srcdir}"/PowerPoint.desktop "${pkgdir}"/usr/share/applications/PowerPoint.desktop
    install -Dm644 "${srcdir}"/Excel.desktop "${pkgdir}"/usr/share/applications/Excel.desktop
    install -Dm644 "${srcdir}"/Word.desktop "${pkgdir}"/usr/share/applications/Word.desktop
    install -Dm644 "${srcdir}"/Outlook.desktop "${pkgdir}"/usr/share/applications/Outlook.desktop
    install -Dm644 "${srcdir}"/OneNote.desktop "${pkgdir}"/usr/share/applications/OneNote.desktop
    install -Dm644 "${srcdir}"/WebSkype.desktop "${pkgdir}"/usr/share/applications/WebSkype.desktop
}
